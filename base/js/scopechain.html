<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JavaScript 作用域和闭包 | Blog</title>
    <meta name="description" content="个人工作资料与笔记">
    <link rel="icon" href="/blog/favicon.ico">
    
    <link rel="preload" href="/blog/assets/css/0.styles.51f87dfa.css" as="style"><link rel="preload" href="/blog/assets/js/app.4352e386.js" as="script"><link rel="preload" href="/blog/assets/js/5.da5e5d44.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.d4321f39.js"><link rel="prefetch" href="/blog/assets/js/11.418beadb.js"><link rel="prefetch" href="/blog/assets/js/12.70132eb8.js"><link rel="prefetch" href="/blog/assets/js/13.055bf41e.js"><link rel="prefetch" href="/blog/assets/js/14.649908b4.js"><link rel="prefetch" href="/blog/assets/js/15.435d3ff3.js"><link rel="prefetch" href="/blog/assets/js/16.eb1dc4f2.js"><link rel="prefetch" href="/blog/assets/js/17.6374d77c.js"><link rel="prefetch" href="/blog/assets/js/18.af3a8a0e.js"><link rel="prefetch" href="/blog/assets/js/19.a8bd4052.js"><link rel="prefetch" href="/blog/assets/js/2.d9c402ee.js"><link rel="prefetch" href="/blog/assets/js/20.15385d52.js"><link rel="prefetch" href="/blog/assets/js/21.23d21be4.js"><link rel="prefetch" href="/blog/assets/js/22.ac7800e8.js"><link rel="prefetch" href="/blog/assets/js/23.c01c6890.js"><link rel="prefetch" href="/blog/assets/js/24.a8018a16.js"><link rel="prefetch" href="/blog/assets/js/25.740ba2c4.js"><link rel="prefetch" href="/blog/assets/js/26.e22fd3fb.js"><link rel="prefetch" href="/blog/assets/js/27.b3844cb5.js"><link rel="prefetch" href="/blog/assets/js/28.54f28a8e.js"><link rel="prefetch" href="/blog/assets/js/29.773c2e45.js"><link rel="prefetch" href="/blog/assets/js/3.97d3241b.js"><link rel="prefetch" href="/blog/assets/js/30.7538d59a.js"><link rel="prefetch" href="/blog/assets/js/31.6d85d3b8.js"><link rel="prefetch" href="/blog/assets/js/32.1f14c6b0.js"><link rel="prefetch" href="/blog/assets/js/33.1cc59ee7.js"><link rel="prefetch" href="/blog/assets/js/34.5d992f91.js"><link rel="prefetch" href="/blog/assets/js/35.4f1bf7c4.js"><link rel="prefetch" href="/blog/assets/js/4.f767d8f6.js"><link rel="prefetch" href="/blog/assets/js/6.71ac3003.js"><link rel="prefetch" href="/blog/assets/js/7.8b013ba8.js"><link rel="prefetch" href="/blog/assets/js/8.5ef64e5e.js"><link rel="prefetch" href="/blog/assets/js/9.7fa8b85f.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.51f87dfa.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">Blog</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/base/js/dom-event.html" class="nav-link">前端技术栈</a></div><div class="nav-item"><a href="/blog/more/web-optimization.html" class="nav-link">扩展阅读</a></div> <a href="https://github.com/guiguzigang/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/base/js/dom-event.html" class="nav-link">前端技术栈</a></div><div class="nav-item"><a href="/blog/more/web-optimization.html" class="nav-link">扩展阅读</a></div> <a href="https://github.com/guiguzigang/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav> <div><ins data-ad-client="ca-pub-4613560834313397" data-ad-slot="2465217753" class="adsbygoogle" style="display:block;box-sizing:border-box;width:100%;height:120px;margin:10px auto 0;"></ins></div> <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading open"><span>JavaScript</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/blog/base/js/dom-event.html" class="sidebar-link">DOM事件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/base/js/dom-event.html#基本概念：dom事件的级别" class="sidebar-link">基本概念：DOM事件的级别</a></li><li class="sidebar-sub-header"><a href="/blog/base/js/dom-event.html#dom事件模型，事件流" class="sidebar-link">DOM事件模型，事件流</a></li><li class="sidebar-sub-header"><a href="/blog/base/js/dom-event.html#描述dom事件捕获的具体流程" class="sidebar-link">描述DOM事件捕获的具体流程</a></li><li class="sidebar-sub-header"><a href="/blog/base/js/dom-event.html#event对象的常见应用" class="sidebar-link">Event对象的常见应用</a></li><li class="sidebar-sub-header"><a href="/blog/base/js/dom-event.html#自定义事件" class="sidebar-link">自定义事件</a></li></ul></li><li><a href="/blog/base/js/scopechain.html" class="active sidebar-link">JavaScript 作用域和闭包</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/base/js/scopechain.html#变量提升" class="sidebar-link">变量提升</a></li><li class="sidebar-sub-header"><a href="/blog/base/js/scopechain.html#this-的使用场景" class="sidebar-link">this 的使用场景</a></li><li class="sidebar-sub-header"><a href="/blog/base/js/scopechain.html#作用域" class="sidebar-link">作用域</a></li><li class="sidebar-sub-header"><a href="/blog/base/js/scopechain.html#闭包的应用" class="sidebar-link">闭包的应用</a></li></ul></li><li><a href="/blog/base/js/prototype.html" class="sidebar-link">Javascript 原型链</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/base/js/prototype.html#创建对象的几种方法" class="sidebar-link">创建对象的几种方法</a></li><li class="sidebar-sub-header"><a href="/blog/base/js/prototype.html#原型、构造函数、实例、原型链" class="sidebar-link">原型、构造函数、实例、原型链</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/base/js/prototype.html#什么是原型对象？实例？构造函数？" class="sidebar-link">什么是原型对象？实例？构造函数？</a></li><li class="sidebar-sub-header"><a href="/blog/base/js/prototype.html#什么是原型链？" class="sidebar-link">什么是原型链？</a></li><li class="sidebar-sub-header"><a href="/blog/base/js/prototype.html#原型对象和实例之间有什么作用？" class="sidebar-link">原型对象和实例之间有什么作用？</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/base/js/prototype.html#instanceof的原理" class="sidebar-link">instanceof的原理</a></li><li class="sidebar-sub-header"><a href="/blog/base/js/prototype.html#new运算符" class="sidebar-link">new运算符</a></li></ul></li><li><a href="/blog/base/js/class.html" class="sidebar-link">Javascript类与继承</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/base/js/class.html#类的声明与实例化" class="sidebar-link">类的声明与实例化</a></li><li class="sidebar-sub-header"><a href="/blog/base/js/class.html#继承的几种方式" class="sidebar-link">继承的几种方式</a></li></ul></li><li><a href="/blog/base/js/package-compiled.html" class="sidebar-link">ES6语法的编译</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/base/js/package-compiled.html#babel-编译" class="sidebar-link">Babel 编译</a></li><li class="sidebar-sub-header"><a href="/blog/base/js/package-compiled.html#webpack" class="sidebar-link">Webpack</a></li></ul></li><li><a href="/blog/base/js/generator.html" class="sidebar-link">Generatator 实现长轮询</a></li><li><a href="/blog/base/js/equal-operator.html" class="sidebar-link">==和===</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/base/js/equal-operator.html#相等操作符（-）" class="sidebar-link">相等操作符（==）</a></li><li class="sidebar-sub-header"><a href="/blog/base/js/equal-operator.html#全等操作符（-）" class="sidebar-link">全等操作符（===）</a></li></ul></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>CSS</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>前端框架</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>可视化</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>NodeJs</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>HTTP协议</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>命令行工具</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="javascript-作用域和闭包"><a href="#javascript-作用域和闭包" aria-hidden="true" class="header-anchor">#</a> JavaScript 作用域和闭包</h1> <h2 id="变量提升"><a href="#变量提升" aria-hidden="true" class="header-anchor">#</a> 变量提升</h2> <p>首先我们要知道，js 的执行顺序是由上到下的，但这个顺序，并不完全取决于你，因为 js 中存在变量的声明提升。
这里比较简单，直接上代码：</p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//undefined</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>

<span class="token function">fn</span><span class="token punctuation">(</span><span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  age <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//zhangsan 20</span>
  <span class="token keyword">var</span> age<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>打印<code>a</code>的时候，<code>a</code>并没有声明，为什么不报错，而是打印<code>undefined</code>。
执行<code>fn</code>的时候<code>fn</code>并没有声明，为什么<code>fn</code>的语句会执行？
这就是变量的声明提升，代码虽然写成这样，但其实执行顺序是这样的。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> a<span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  age <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
a <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>

<span class="token function">fn</span><span class="token punctuation">(</span><span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>js 会把所有的声明提到前面，然后再顺序执行赋值等其它操作，因为在打印<code>a</code>之前已经存在<code>a</code>这个变量了，只是没有赋值，所以会打印出<code>undefined</code>，为不是报错，<code>fn</code>同理。</p> <p>这里要注意函数声明和函数表达式的区别。上例中的<code>fn</code>是函数声明。接下来通过代码区分一下。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">fn1</span><span class="token punctuation">(</span><span class="token string">&quot;abc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">fn1</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">fn2</span><span class="token punctuation">(</span><span class="token string">&quot;def&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> <span class="token function-variable function">fn2</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>本例中 fn1 是函数声明，而 fn2 是函数表达式。函数表达式中的函数体是不会被提升的。</p> <p>结果：</p> <div align="center"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAWwAAABCCAYAAABzTuxLAAAQLklEQVR4Ae2dC3BU1RnH/5sHkEhiAkRexZZCAAHfEajYwFSgKJW2PLR26Iytj9GiDqigM6WjMnQqKohiHAo6aIcZikHsgNQpogYEpoAFMYGiJKUSIzgDBHkE8tzO/96c7N1lX3nsso//N3P37j3P7/zOOd/97rl377rq6urca9aswYwZMyARAREQARGIXQIpsauaNBMBERABEXASSDMHhw4dMl+1FwEREAERiEECLQY7Pz8/BtWTSiIgAiIgAoaAlkQMCe1FQAREIMYJyGDHeAdJPREQAREwBGSwDQntRUAERCDGCchgx3gHST0REAERMARksA0J7UVABEQgxgnIYMd4B0k9ERABETAELpnBrq6uxuzZs8G9RAREQAREIDSBS2awQ6umFCIgAiIgAk4CETfY5eXlKCwsxIABA6ytuLjYWT9Wr15thTMN0xqh5z116tSWfDt37jRR2ouACIhAUhKIuMEeOHAgtm7dioqKCpSVlaG0tLTFMB85cgR5eXlW3AsvvICioiKcP3/e2ubPn4+5c+daccw7cuTIpOwgNVoEREAEDIGIG2ynpzx8+HCUlJSYunHllVdi3Lhx1vGgQYOs/YULF1BVVYWsrCxcc801LWn1RQREQASSnUDEDfaKFSss79h42GPHjvXL/MSJE5aR7tKli994BYqACIhAshOIuMEm4P79+1ucP//8cy8P2wl/79696Nq1KzIyMtC9e3fs378fTC8RAREQARGwCUTcYE+ZMgVLly61bh5u3LgRTg+ba9gFBQVW3I4dO/DII49YWuXm5mLhwoWYM2eObjpqpIqACIhAMwGX/nFGY0EEREAE4oNAxD3s+MAgLUVABEQg9gnIYMd+H0lDERABEbAIyGBrIIiACIhAnBBo+YswHDwYJypLTREQARFITgIeg927d3ISUKtFQAREIE4IaEkkTjpKaoqACIiADLbGgAiIgAjECQHPkkgAhd2NjWioPomTH/wTpzduhLv6FFy5OcieNAndxv8U6T3yAuRUsAiIgAiIQEcSCGmwG6qrcey1IqT+uww5SAHcXYAzjaj/299x7FA5ev3+YaT36NGROqksERABERABPwRCLomcKilB2p4D6HJFT6QPHoSUrCxrz2OGM14iAnFNYNUq4P77gfPn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"></div> <p>可以看到 fn1 被提升了，而 fn2 的函数体并没有被提升。</p> <p>效果等同于：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> fn2<span class="token punctuation">;</span>
<span class="token function">fn2</span><span class="token punctuation">(</span><span class="token string">&quot;def&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function-variable function">fn2</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="this-的使用场景"><a href="#this-的使用场景" aria-hidden="true" class="header-anchor">#</a> this 的使用场景</h2> <p><code>this</code>简单理解就是调用函数的那个对象。
要搞懂<code>this</code>，首先要理解一句话：<code>this</code>要在执行时才能确认，定义时无法确认。</p> <p>接下来还是在代码中解释这句话</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'A'</span><span class="token punctuation">,</span>
  fn<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>看这段代码，<code>this</code>指向谁？
现在说指向谁都是不对的，<code>this</code>在定义时是无法确认的，只有执行时才能确认。
继续上面代码，判断以下<code>this</code>的指向。</p> <div class="language-js extra-class"><pre class="language-js"><code>a<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//this === a</span>

a<span class="token punctuation">.</span>fn<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">&quot;B&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//this === {name: 'B'}</span>

<span class="token keyword">var</span> fn1 <span class="token operator">=</span> a<span class="token punctuation">.</span>fn<span class="token punctuation">;</span>
<span class="token function">fn1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//this === window</span>
</code></pre></div><p>代码中已经给出答案了。虽然<code>fn</code>定义在<code>a</code>对象里，但是<code>fn</code>中<code>this</code>的指向并不总是指向<code>a</code>，谁调用<code>fn</code>，<code>this</code>就指向谁。
看一下输出结果：</p> <div align="center"><img src="data:image/png;base64,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"></div> <p><code>window</code>没有<code>name</code>属性，所以最后一行为空。</p> <p>this 都有哪种使用场景呢？
主要由以下 4 点</p> <ol><li>作为构造函数执行</li> <li>作为对象属性执行</li> <li>作为普通函数执行</li> <li>call apply bind</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//作为构造函数执行</span>
<span class="token keyword">function</span> <span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name
<span class="token punctuation">}</span>
<span class="token keyword">var</span> f <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span><span class="token string">'zhangsan'</span><span class="token punctuation">)</span>

<span class="token comment">//作为对象属性</span>
<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">'A'</span><span class="token punctuation">,</span>
    printName<span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
obj<span class="token punctuation">.</span><span class="token function">printName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">//作为普通对象</span>
<span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token comment">//此时的this指向window</span>
<span class="token punctuation">}</span>
<span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>前三种通过代码一看就明白了，不用多说，接下说一下<code>call</code>、<code>apply</code> 和 <code>bind</code>
这三个的作用都是改变<code>this</code>的指向，<code>call</code>和<code>apply</code>不同的地方就在于传递参数的部分，<code>apply</code>要用数组，还是在代码中看。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">fn1</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//call和apply用法的不同</span>
fn1<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">100</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fn1<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">100</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//参数放在数组里</span>
</code></pre></div><p><code>call</code>和<code>apply</code>的第一个参数都是<code>this</code>的指向，之后是构造函数的参数。
输出结果：</p> <div align="center"><img src="/blog/assets/img/3.06caf573.png"></div> <p>可以看到，两种方式的输出结果是一样的。
再然后是<code>bind</code>，<code>bind</code>和前面两个都不太一样，<code>bind</code>不是在函数执行时调用的，而是在函数声明时。</p> <p>看代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">fn2</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token punctuation">{</span> y<span class="token punctuation">:</span> <span class="token number">200</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//在函数声明时绑定this的指向</span>

<span class="token function">fn2</span><span class="token punctuation">(</span><span class="token string">&quot;lisi&quot;</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>结果：</p> <div align="center"><img src="data:image/png;base64,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"></div> <p>有一点需要注意，只有函数表达式才能使用 bind，函数声明是不能用的，来一个错误的演示：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//错误演示</span>
<span class="token keyword">function</span> <span class="token function">fn3</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span>age<span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span>age<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token punctuation">{</span>z<span class="token punctuation">:</span><span class="token number">300</span><span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token comment">//错误演示</span>

<span class="token comment">//错误演示</span>
<span class="token function">fn3</span><span class="token punctuation">(</span><span class="token string">'lisi'</span><span class="token punctuation">,</span><span class="token number">23</span><span class="token punctuation">)</span>
</code></pre></div><div align="center"><img src="data:image/png;base64,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"></div> <h2 id="作用域"><a href="#作用域" aria-hidden="true" class="header-anchor">#</a> 作用域</h2> <p>首先要知道，JavaScript 是没有块级作用域的，下面的例子会正常运行，没有报错</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// zhangsan</span>
</code></pre></div><p>其次，还要知道全局作用域和函数作用域</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;fn&quot;</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//这里的a是200</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;global&quot;</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 这里的a是100</span>
<span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>在函数里声明的变量，在是不会影响外面的变量的，看结果：</p> <div align="center"><img src="data:image/png;base64,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"></div> <p>这些都了解了后，我们来看作用域链。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//a为自由变量 // 100</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 200</span>
<span class="token punctuation">}</span>
<span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>还要注意一点，作用域链实在定义时确定的，不是在执行时，不管在哪个作用域下调用某个函数，该函数内的作用域链是不会变得，再来看一段代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token constant">F1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> y <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token constant">F2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> z <span class="token operator">=</span> <span class="token number">300</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//自由变量</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//自由变量</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token constant">F2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token constant">F1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>我们看<code>x</code>变量，这是一个自由变量，<code>js引擎</code>在执行到<code>console.log(x)</code>时，会先在<code>F2</code>中寻找<code>x</code>，没找到就去当前作用域的父级作用域<code>F1</code>中找，还找不到就在往上找直到全局作用域。</p> <p>因为定义时作用域链已经确定了，不管这条链上的函数是在哪里调用的，这条作用域链不会在改了。</p> <h2 id="闭包的应用"><a href="#闭包的应用" aria-hidden="true" class="header-anchor">#</a> 闭包的应用</h2> <p>出于种种原因，我们有时候需要得到函数内的局部变量。但是，前面已经说过了，正常情况下，这是办不到的，只有通过变通方法才能实现。</p> <p>那就是在函数的内部，再定义一个函数,然后把这个函数返回。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token constant">F1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
  <span class="token comment">//返回一个函数 (函数作为返回值)</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//f1得到一个函数</span>
<span class="token keyword">var</span> f1 <span class="token operator">=</span> <span class="token constant">F1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>
<span class="token function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 100</span>
</code></pre></div><p>在本例中就实现了闭包，简单的说，闭包就是能够读取其他函数内部变量的函数。</p> <p>下面说为什么打印的是 100
看这句 <code>var f1 = F1()</code>; <code>F1</code>这个函数执行的结果是返回一个函数，所以就相当于把 F1 内的函数付给了 f1 变量，类似于这样</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">f1</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//这里的a是一个自由变量</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>这里的<code>a</code>是一个自由变量，所以根据作用域链的原理，就应该去上一级作用域去找。之前说过，作用域链在定义时确定，和执行无关，那就去想上找，这个函数定义定义在<code>F1</code>中，所以会在<code>F1</code>中找<code>a</code>这个变量，所以这里会打印的 100。</p> <p>通过这种方式，我们在全局下就读取到了<code>F1</code>函数内部定义的变量，这就是闭包。</p> <p><strong>闭包主要有以下两种应用场景</strong></p> <ul><li>函数作为返回值</li> <li>函数作为参数来传递</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token constant">F1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> f1 <span class="token operator">=</span> <span class="token constant">F1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token constant">F2</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>
  <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token constant">F2</span><span class="token punctuation">(</span>f1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 100</span>
</code></pre></div><p><strong>例题</strong>
创建 10 个<code>&lt;a&gt;</code>标签，点击的时候输出对应的序号</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 错误代码演示</span>
<span class="token keyword">var</span> i<span class="token punctuation">,</span> a<span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  a <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  a<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token string">&quot;&lt;br /&gt;&quot;</span><span class="token punctuation">;</span>
  a<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 10</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>因为上例代码都是同步执行的，在页面加载的一瞬间，<code>for</code> 循环已经执行完毕，我再去点标签的时候，i 的值已经是 10 了，所以不管我点第几个标签，打印的都会是 10。</p> <p>以下是正确代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    a <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    a<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token string">&quot;&lt;br /&gt;&quot;</span><span class="token punctuation">;</span>
    a<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/guiguzigang/blog/edit/master/docs/base/js/scopechain.md" target="_blank" rel="noopener noreferrer">欢迎指正</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/blog/base/js/dom-event.html" class="prev">
          DOM事件
        </a></span> <span class="next"><a href="/blog/base/js/prototype.html">
          Javascript 原型链
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/blog/assets/js/5.da5e5d44.js" defer></script><script src="/blog/assets/js/app.4352e386.js" defer></script>
  </body>
</html>
