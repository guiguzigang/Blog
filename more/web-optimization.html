<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>前端性能优化 | Blog</title>
    <meta name="description" content="个人工作资料与笔记">
    <link rel="icon" href="/blog/favicon.ico">
    
    <link rel="preload" href="/blog/assets/css/0.styles.51f87dfa.css" as="style"><link rel="preload" href="/blog/assets/js/app.4352e386.js" as="script"><link rel="preload" href="/blog/assets/js/2.d9c402ee.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.d4321f39.js"><link rel="prefetch" href="/blog/assets/js/11.418beadb.js"><link rel="prefetch" href="/blog/assets/js/12.70132eb8.js"><link rel="prefetch" href="/blog/assets/js/13.055bf41e.js"><link rel="prefetch" href="/blog/assets/js/14.649908b4.js"><link rel="prefetch" href="/blog/assets/js/15.435d3ff3.js"><link rel="prefetch" href="/blog/assets/js/16.eb1dc4f2.js"><link rel="prefetch" href="/blog/assets/js/17.6374d77c.js"><link rel="prefetch" href="/blog/assets/js/18.af3a8a0e.js"><link rel="prefetch" href="/blog/assets/js/19.a8bd4052.js"><link rel="prefetch" href="/blog/assets/js/20.15385d52.js"><link rel="prefetch" href="/blog/assets/js/21.23d21be4.js"><link rel="prefetch" href="/blog/assets/js/22.ac7800e8.js"><link rel="prefetch" href="/blog/assets/js/23.c01c6890.js"><link rel="prefetch" href="/blog/assets/js/24.a8018a16.js"><link rel="prefetch" href="/blog/assets/js/25.740ba2c4.js"><link rel="prefetch" href="/blog/assets/js/26.e22fd3fb.js"><link rel="prefetch" href="/blog/assets/js/27.b3844cb5.js"><link rel="prefetch" href="/blog/assets/js/28.54f28a8e.js"><link rel="prefetch" href="/blog/assets/js/29.773c2e45.js"><link rel="prefetch" href="/blog/assets/js/3.97d3241b.js"><link rel="prefetch" href="/blog/assets/js/30.7538d59a.js"><link rel="prefetch" href="/blog/assets/js/31.6d85d3b8.js"><link rel="prefetch" href="/blog/assets/js/32.1f14c6b0.js"><link rel="prefetch" href="/blog/assets/js/33.1cc59ee7.js"><link rel="prefetch" href="/blog/assets/js/34.5d992f91.js"><link rel="prefetch" href="/blog/assets/js/35.4f1bf7c4.js"><link rel="prefetch" href="/blog/assets/js/4.f767d8f6.js"><link rel="prefetch" href="/blog/assets/js/5.da5e5d44.js"><link rel="prefetch" href="/blog/assets/js/6.71ac3003.js"><link rel="prefetch" href="/blog/assets/js/7.8b013ba8.js"><link rel="prefetch" href="/blog/assets/js/8.5ef64e5e.js"><link rel="prefetch" href="/blog/assets/js/9.7fa8b85f.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.51f87dfa.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">Blog</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/base/js/dom-event.html" class="nav-link">前端技术栈</a></div><div class="nav-item"><a href="/blog/more/web-optimization.html" class="nav-link router-link-exact-active router-link-active">扩展阅读</a></div> <a href="https://github.com/guiguzigang/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/base/js/dom-event.html" class="nav-link">前端技术栈</a></div><div class="nav-item"><a href="/blog/more/web-optimization.html" class="nav-link router-link-exact-active router-link-active">扩展阅读</a></div> <a href="https://github.com/guiguzigang/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav> <div><ins data-ad-client="ca-pub-4613560834313397" data-ad-slot="2465217753" class="adsbygoogle" style="display:block;box-sizing:border-box;width:100%;height:120px;margin:10px auto 0;"></ins></div> <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>扩展阅读</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/blog/more/web-optimization.html" class="active sidebar-link">前端性能优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/more/web-optimization.html#资源合并与压缩" class="sidebar-link">资源合并与压缩</a></li><li class="sidebar-sub-header"><a href="/blog/more/web-optimization.html#图片相关的优化" class="sidebar-link">图片相关的优化</a></li><li class="sidebar-sub-header"><a href="/blog/more/web-optimization.html#懒加载与预加载" class="sidebar-link">懒加载与预加载</a></li><li class="sidebar-sub-header"><a href="/blog/more/web-optimization.html#重绘回流" class="sidebar-link">重绘回流</a></li><li class="sidebar-sub-header"><a href="/blog/more/web-optimization.html#浏览器存储" class="sidebar-link">浏览器存储</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/more/web-optimization.html#cookie" class="sidebar-link">Cookie</a></li><li class="sidebar-sub-header"><a href="/blog/more/web-optimization.html#localstorage与sessionstorage" class="sidebar-link">LocalStorage与SessionStorage</a></li><li class="sidebar-sub-header"><a href="/blog/more/web-optimization.html#indexdb" class="sidebar-link">IndexDB</a></li><li class="sidebar-sub-header"><a href="/blog/more/web-optimization.html#service-worker" class="sidebar-link">Service Worker</a></li><li class="sidebar-sub-header"><a href="/blog/more/web-optimization.html#pwa" class="sidebar-link">PWA</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/more/web-optimization.html#缓存" class="sidebar-link">缓存</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/more/web-optimization.html#cache-control" class="sidebar-link">Cache-Control</a></li><li class="sidebar-sub-header"><a href="/blog/more/web-optimization.html#expires" class="sidebar-link">Expires</a></li><li class="sidebar-sub-header"><a href="/blog/more/web-optimization.html#last-modified-if-modified-since" class="sidebar-link">Last-Modified/If-Modified-Since</a></li><li class="sidebar-sub-header"><a href="/blog/more/web-optimization.html#etag-if-none-match" class="sidebar-link">Etag/If-None-Match</a></li></ul></li></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="前端性能优化"><a href="#前端性能优化" aria-hidden="true" class="header-anchor">#</a> <a href="https://coding.imooc.com/class/chapter/130.html" target="_blank" rel="noopener noreferrer">前端性能优化<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h1> <p><a href="https://processon.com/view/59e74772e4b05f52bada3e27" target="_blank" rel="noopener noreferrer">思维导图<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>WEB前端本质上是一种GUI软件，本可以直接借鉴其它GUI系统架构设计方案，但WEB前端有点特别：传统的CS架构的GUI软件，是软件开发完后，将软件打包发布到相关的应用平台上，需要用户从应用平台下载到本地解压安装后使用，实际上用户在使用软件时，用户本地是在访问本地的一些资源，而WEB前端（BS架构）则是开发完后将代码发布到服务器、cdn上，用户使用时，只需要通过浏览器访问网址，而浏览器则会向远程的服务器发送请求，服务器返回相关资源，这个过程是一个动态的增量的加载相关资源；所以缩短服务器向浏览器返回数据的时间就能让客户的体验更好。</p> <p>首先了解一下，浏览器的一个请求从发送到返回都经历了什么？
</p><div align="center"><img src="/blog/assets/img/1.3b795b0f.png"></div><p></p> <p><strong>请求过程中一些潜在的性能优化点：</strong></p> <ul><li>dns可以通过缓存，减少dns查询时间</li> <li>网络请求的过程走最近的网络环境</li> <li>相同的静态资源缓存</li> <li>减少请求http请求大小</li> <li>减少http请求</li> <li>服务端渲染</li></ul> <h2 id="资源合并与压缩"><a href="#资源合并与压缩" aria-hidden="true" class="header-anchor">#</a> 资源合并与压缩</h2> <p><strong>资源合并与压缩主要就是减少http请求数量和减少请求资源大小</strong></p> <p>资源压缩可以从以下几个方面着手：</p> <ul><li>html压缩
<ul><li>nodejs提供的html-minifier</li> <li>后端模板引擎渲染压缩</li></ul></li> <li>css压缩(无效代码删除, css语义合并)
<ul><li>html-minifier对html中的css进行压缩</li> <li>clean-css对css进行压缩</li></ul></li> <li>js的压缩与混乱(无效字符的删除、剔除注释、代码语义的缩减和优化、代码保护)
<ul><li>html-minifier对html中的js进行压缩</li> <li>uglifyjs2对js进行压缩</li></ul></li> <li>文件合并
<ul><li>文件与文件之间有插入的上行请求，增加了N-1个网络延迟</li> <li>丢包问题影响更严重</li> <li>经过代理服务器时可能会被断开</li></ul></li> <li>开启gzip</li></ul> <h2 id="图片相关的优化"><a href="#图片相关的优化" aria-hidden="true" class="header-anchor">#</a> 图片相关的优化</h2> <p><strong>png8/png24/png32之间的区别</strong></p> <ul><li>png8 —— 256色 + 支持透明</li> <li>png24 —— 2^24色 + 不支持透明</li> <li>png32 —— 2^24色 + 支持透明</li></ul> <p><strong>不同格式图片常用的业务场景</strong></p> <ul><li>jpg有损压缩，压缩率高，不支持透明</li> <li>png支持透明，浏览器兼容好</li> <li>webp压缩程度更好，在ios webview有兼容性问题</li> <li>svg矢量图，代码内嵌，相对较小，图片样式相对简单的场景</li></ul> <p><strong>优化方案</strong></p> <ul><li>进行图片压缩</li> <li>CSS雪碧图(减少你的网站的HTTP请求数量)</li> <li>Image inline(将图片的内容内嵌到html当中)</li> <li>使用SVG进行矢量图的绘制</li> <li>使用iconfont解决icon问题</li> <li>在安卓下使用webp</li></ul> <h2 id="懒加载与预加载"><a href="#懒加载与预加载" aria-hidden="true" class="header-anchor">#</a> 懒加载与预加载</h2> <p><strong>懒加载</strong></p> <ul><li>图片进入可视区域之后请求图片资源</li> <li>对于电商等图片很多，页面很长的业务场景适用</li> <li>减少无效资源的加载</li> <li>并发加载的资源过多会阻塞JS的加载，影响网站的正常使用</li></ul> <p><strong>懒加载实现原理</strong>
判断图片距离可视区顶部的距离是否小于可视区的高度，如果小于则加载图图片资源，使用lazyload时必须固定图片的宽高</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>image-list<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span> <span class="token attr-name">lazyload</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-original</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.sanjiaoniu.com/files/1506/1-1506130ZT90-L.jpg<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span> <span class="token attr-name">lazyload</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-original</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.sanjiaoniu.com/files/1506/1-1506130ZT90-L.jpg<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span> <span class="token attr-name">lazyload</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-original</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.sanjiaoniu.com/files/1506/1-1506130ZT90-L.jpg<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span> <span class="token attr-name">lazyload</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-original</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.sanjiaoniu.com/files/1506/1-1506130ZT90-L.jpg<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span> <span class="token attr-name">lazyload</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-original</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.sanjiaoniu.com/files/1506/1-1506130ZT90-L.jpg<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span> <span class="token attr-name">lazyload</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-original</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.sanjiaoniu.com/files/1506/1-1506130ZT90-L.jpg<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span> <span class="token attr-name">lazyload</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-original</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.sanjiaoniu.com/files/1506/1-1506130ZT90-L.jpg<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span> <span class="token attr-name">lazyload</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-original</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.sanjiaoniu.com/files/1506/1-1506130ZT90-L.jpg<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span> <span class="token attr-name">lazyload</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-original</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.sanjiaoniu.com/files/1506/1-1506130ZT90-L.jpg<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span> <span class="token attr-name">lazyload</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-original</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.sanjiaoniu.com/files/1506/1-1506130ZT90-L.jpg<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span> <span class="token attr-name">lazyload</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-original</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.sanjiaoniu.com/files/1506/1-1506130ZT90-L.jpg<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span> <span class="token attr-name">lazyload</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-original</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.sanjiaoniu.com/files/1506/1-1506130ZT90-L.jpg<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> viewHeight <span class="token operator">=</span> document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>clientHeight <span class="token comment">// 可视区高度</span>
<span class="token keyword">function</span> <span class="token function">lazyload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> eles <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectAll</span><span class="token punctuation">(</span><span class="token string">'img[data-original][lazyload]'</span><span class="token punctuation">)</span>

  Array<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>forEach<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>eles<span class="token punctuation">,</span> <span class="token punctuation">(</span>item<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> rect
    <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>original <span class="token operator">===</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token keyword">return</span>
    rect <span class="token operator">=</span> item<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>rect<span class="token punctuation">.</span>bottom <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> rect<span class="token punctuation">.</span>top <span class="token operator">&lt;</span> viewHeight<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token operator">!</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        img<span class="token punctuation">.</span>src <span class="token operator">=</span> item<span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>original
        img<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          item<span class="token punctuation">.</span>src <span class="token operator">=</span> img<span class="token punctuation">.</span>src
        <span class="token punctuation">}</span>
        item<span class="token punctuation">.</span><span class="token function">removeAttribute</span><span class="token punctuation">(</span><span class="token string">'data-original'</span><span class="token punctuation">)</span>
        item<span class="token punctuation">.</span><span class="token function">removeAttribute</span><span class="token punctuation">(</span><span class="token string">'lazyload'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">lazyload</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'scroll'</span><span class="token punctuation">,</span> lazyload<span class="token punctuation">)</span>
</code></pre></div><p><strong>预加载</strong></p> <ul><li>图片等静态资源在使用之前的提前请求</li> <li>资源使用到时能从缓存中加载，提升用户体验</li> <li>页面展示的依赖关系维护</li></ul> <p><strong>预加载的实现</strong></p> <ul><li>直接使用img标签，并设置<code>style=&quot;display: none;&quot;</code></li> <li>使用img对象<code>new Image()</code></li> <li>使用ajax（XMLHttpRequest）请求
<ul><li>优点：可以精细的控制，监听请求过去</li> <li>缺点：不能跨域</li></ul></li> <li>PreloadJS库</li></ul> <h2 id="重绘回流"><a href="#重绘回流" aria-hidden="true" class="header-anchor">#</a> 重绘回流</h2> <p>html 页面加载渲染的过程
</p><div align="center"><img src="/blog/assets/img/2.14082886.png"></div><p></p> <p><strong>回流（Reflow）</strong></p> <p>当render tree中的一部分(或全部)因为元素的规模尺寸，布局，隐藏等改变而需要重新构建,这就称为回流(reflow)；当页面布局和几何属性改变时就需要回流。</p> <div class="tip custom-block"><p class="custom-block-title">注意：</p> <p>回流必将引起重绘，而重绘不一定会引起回流；</p></div> <p><strong>重绘（Paint）</strong></p> <p>当render tree中的一些元素需要更新属性，而这些属性只是影响元素的外观，风格，而不会影响布局的，比如background-color，则就叫称为重绘。</p> <p><strong>触发页面重布局的属性</strong></p> <ul><li>盒子模型相关属性会触发重布局</li> <li>定位属性及浮动也会触发重布局</li> <li>改变节点内部文字结构也会触发重布局</li></ul> <p><code>width、height、padding、margin、display、border-width、border、min-height、top、bottom、left、right、position、float、clear、text-align、overflow-y、font-weight、overflow、font-family、line-height、vertival-align、white-space、font-size</code></p> <p><strong>只触发重绘的属性</strong></p> <p><code>color、border-style、border-radius、visibility、text-decoration、background、background-image、background-position、background-repeat、background-size、outline-color、outline、outline-style、outline-width、box-shadow</code></p> <p><strong>新建DOM的过程</strong></p> <ol><li>获取DOM后分割为多个图层</li> <li>对每个图层的节点计算样式结果（Recalculate style--样式重计算）</li> <li>为每个节点生成图形和位置（Layout--回流和重布局）</li> <li>将每个节点绘制填充到图层位图中（Paint Setup和Paint--重绘）</li> <li>图层作为纹理上传至GPU</li> <li>符合多个图层到页面上生成最终屏幕图像（Composite Layers--图层重组）</li></ol> <p><strong>Chrome创建图层的条件（devtool: performance、layout）</strong></p> <ul><li>3D或透视变换（perspective / transform: translateZ(0) / will-change: transform）CSS属性</li> <li>使用加速视频解码的video节点</li> <li>拥有3D（WebGL）上下文或加速的2D上下文的canvas节点</li> <li>混合插件（如Flash）</li> <li>对自己的opacity做CSS动画或使用一个动画变换的元素</li> <li>拥有CSS过滤器的元素</li> <li>元素有一个包含复合层的后代节点（一个元素拥有一个子元素，该子元素在自己的层里）</li> <li>元素有一个z-index较低且包含一个复合层的兄弟元素（换句话说就是该元素在复合层上面渲染）</li></ul> <p><strong>实战优化点</strong></p> <ol><li>用translate替代top改变</li> <li>用opacity替代visibility</li> <li>不要一条一条地修改 DOM 的样式，预先定义好 class，然后修改 DOM 的 className</li> <li>把 DOM 离线后修改，比如：先把 DOM 给 display:none (有一次 Reflow)，然后你修改100次，然后再把它显示出来</li> <li>不要把 DOM 结点的属性值放在一个循环里当成循环里的变量</li> <li>不要使用 table 布局，可能很小的一个小改动会造成整个 table 的重新布局</li> <li>动画实现的速度的选择</li> <li>对于动画新建图层</li> <li>启用 GPU 硬件加速</li></ol> <h2 id="浏览器存储"><a href="#浏览器存储" aria-hidden="true" class="header-anchor">#</a> 浏览器存储</h2> <h3 id="cookie"><a href="#cookie" aria-hidden="true" class="header-anchor">#</a> Cookie</h3> <p><strong>优点：</strong></p> <ol><li>因为HTTP请求无状态，所以需要cookie去维持客户端状态</li> <li>过期时间expire</li> <li>cookie的生成方式：</li></ol> <pre><code>* http response header中的set-cookie
* js中可以通过document.cookie可以读写cookie
</code></pre> <p><strong>缺点：</strong></p> <ol><li>仅仅作为浏览器存储，大小4KB左右，能力被localstorage代替</li> <li>cookie在相关域名下面都会携带， cdn的流量损耗，<code>解决方法：cdn 的域名和主站域名分开</code></li></ol> <div class="tip custom-block"><p class="custom-block-title">HttpOnly</p> <p>如果在Cookie中设置了HttpOnly属性，那么通过js脚本将无法读取到cookie信息，这样能有效的防止XSS攻击</p></div> <h3 id="localstorage与sessionstorage"><a href="#localstorage与sessionstorage" aria-hidden="true" class="header-anchor">#</a> LocalStorage与SessionStorage</h3> <p><strong>相同点：</strong></p> <ol><li>HTML5设计出来专门用于浏览器存储的</li> <li>大小为5M左右</li> <li>仅在客户端使用，不与服务端进行通信</li> <li>接口封装较好</li></ol> <p><strong>异同点：</strong></p> <ol><li>Sessionstorage为会话级别的浏览器存储（可用于表单信息的维护）；</li> <li>LocalStorage浏览器本地缓存的方案。</li></ol> <h3 id="indexdb"><a href="#indexdb" aria-hidden="true" class="header-anchor">#</a> IndexDB</h3> <ol><li>IndexedDB 是一种低级API，用于客户端存储大量结构化数据(包括, 文件/ blobs)。该API使用索引来实现对该数据的高性能搜索。虽然 Web Storage 对于存储较少量的数据很有用，但对于存储更大量的结构化数据来说，这种方法不太有用。IndexedDB提供了一个解决方案；</li> <li>为应用创建离线版本。</li></ol> <p>具体使用方法可以查看：</p> <ul><li><a href="http://www.ruanyifeng.com/blog/2018/07/indexeddb.html" target="_blank" rel="noopener noreferrer">浏览器数据库 IndexedDB 入门教程<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/IndexedDB_API" target="_blank" rel="noopener noreferrer">MDN web docs IndexedDB<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h3 id="service-worker"><a href="#service-worker" aria-hidden="true" class="header-anchor">#</a> Service Worker</h3> <p>Service Worker 是一个脚本，浏览器独立与当前网页，将其在后台运行，为实现一些不依赖页面或者用户交互的特性打开了一扇大门。在未来这些特性将包括推送消息，背景后台同步，Gepfencing(地理围栏定位)，但它将推出的第一个首要特性，就是拦截和处理网络请求的能力，包括以编程方式来管理被缓存的响应。</p> <ul><li>使用拦截和处理网络请求的能力，去实现一个离线应用</li> <li>使用Service Worker 在后台运行的同时能和页面通信的能力，去实现大规模后台数据的处理</li></ul> <p><strong>Service Worker 的生命周期</strong></p><div align="center"><img src="/blog/assets/img/3.33373202.png"></div><p></p> <p>Chrome内置的Service Worker工具：</p> <ul><li><a href="chrome://serviceworker-internals/" target="_blank">chrome://serviceworker-internals/</a></li> <li><a href="chrome://inspect/#service-workers" target="_blank">chrome://inspect/#service-workers</a></li></ul> <h3 id="pwa"><a href="#pwa" aria-hidden="true" class="header-anchor">#</a> <a href="https://lavas.baidu.com/pwa" target="_blank" rel="noopener noreferrer">PWA<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>Progressive Web App, 简称 PWA，是提升 Web App 的体验的一种新方法，能给用户原生应用的体验。</p> <p>PWA 能做到原生应用的体验不是靠特指某一项技术，而是经过应用一些新技术进行改进，在安全、性能和体验三个方面都有很大提升，PWA 本质上是 Web App，借助一些新技术也具备了 Native App 的一些特性，兼具 Web App 和 Native App 的优点。</p> <p>PWA 的主要特点包括下面三点：</p> <ul><li>可靠 - 即使在不稳定的网络环境下，也能瞬间加载并展现</li> <li>体验 - 快速响应，并且有平滑的动画响应用户的操作</li> <li>粘性 - 像设备上的原生应用，具有沉浸式的用户体验，用户可以添加到桌面</li></ul> <p>PWA 本身强调渐进式，并不要求一次性达到安全、性能和体验上的所有要求，开发者可以通过 PWA Checklist 查看现有的特征。
<a href="https://chrome.google.com/webstore/detail/lighthouse/blipmdconlkpinefehnmjammfjpmpbjk?hl=zh-CN" target="_blank" rel="noopener noreferrer">Lighthouse<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>这款chrome插件可以帮助你测试网站或软件</p> <ul><li><code>Vue</code>的PWA解决方案<a href="https://lavas.baidu.com/" target="_blank" rel="noopener noreferrer">LAVAS<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="缓存"><a href="#缓存" aria-hidden="true" class="header-anchor">#</a> 缓存</h2> <p>缓存是优化性能、提升体验是一个重要方案。HTTP协议里也包含了控制缓存的部分，通过Cache-Control首部字段来控制，将响应数据缓存至浏览器本地或Web代理中，以达到减少网络延迟及数据传输的开销。
</p><div align="center"><img src="/blog/assets/img/4.9b8dfaf8.jpg"></div><p></p> <h3 id="cache-control"><a href="#cache-control" aria-hidden="true" class="header-anchor">#</a> Cache-Control</h3> <p>可设置的属性值max-age 最大缓存时间，优先级高，s-maxage，public，private，no-cache，no-store
</p><div align="center"><img src="/blog/assets/img/5.5c49d18e.jpg"></div><p></p> <p>资源的缓存策略主要还是在服务器端控制，在响应头中设置Cache-Control参数，可按下图中的维度与步骤来设计：
</p><div align="center"><a href="https://zhuanlan.zhihu.com/p/29697651" target="_blank"><img src="/blog/assets/img/6.96cdb273.jpg"></a></div><p></p> <ol><li>响应是否可复用，有的场景缓存命中率很低，就没必要设置缓存，设置 Cache-Control:no-store 指令；</li> <li>响应可复用时，首先看客户端对数据一致性要求，强一致则需要设置Cache-Control:no-cache 指令，客户端在使用缓存的资源之前，必须先与服务器确认资源是否有变更，如果资源未被更改，可以避免下载。验证响应是否被修改，是通过请求头If-None-match和响应头ETag来实现的；</li> <li>响应可复用时，还要考虑缓存是否能共用，Cache-Control:public 指响应可在Web代理中缓存，多个客户端可共用该响应；Cache-Control:private 指响应只缓存中客户端本地，只能自己使用；</li> <li>最后要设置缓存过期时间，在max-age指定的时间之内，客户端不会向服务器发送任何请求，包括验证缓存是否有效的请求，也就是说，如果在这段时间之内，服务器上的资源发生了变化，那么客户端将不能感知，仍使用老版本数据。所以在设置缓存时间时，需要慎重。</li></ol> <div class="tip custom-block"><p class="custom-block-title">常见的组合有：</p> <ul><li>Cache-Control: private,no-cache,max-age=0</li> <li>Cache-Control: public, max-age=7200</li></ul></div> <h3 id="expires"><a href="#expires" aria-hidden="true" class="header-anchor">#</a> Expires</h3> <ul><li>缓存过期时间，用来指定资源到期的时间，是服务器端的具体时间点</li> <li>告诉浏览器在过期时间前可以直接从浏览器缓存中读取数据，而无需再次请求</li></ul> <h3 id="last-modified-if-modified-since"><a href="#last-modified-if-modified-since" aria-hidden="true" class="header-anchor">#</a> Last-Modified/If-Modified-Since</h3> <ul><li>基于客户端和服务端协商的缓存机制</li> <li>last-modified -- response header</li> <li>if-modified-since -- request header</li> <li>需要与cache-control共同使用</li> <li>缺点：
<ul><li>某些服务端不能获取精确的修改时间</li> <li>文件修改时间改了，但文件内容却没有变</li></ul></li></ul> <h3 id="etag-if-none-match"><a href="#etag-if-none-match" aria-hidden="true" class="header-anchor">#</a> Etag/If-None-Match</h3> <ul><li>文件内容的hash值</li> <li>Etag -- response header</li> <li>if-none-match -- request header</li> <li>需要与cache-control共同使用</li></ul> <p><strong>分级缓存策略</strong></p><div align="center"><img src="/blog/assets/img/7.4305874d.png"></div><p></p> <p><a href="https://www.cnblogs.com/etoah/p/5579622.html" target="_blank" rel="noopener noreferrer">流程图<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><div align="center"><img src="/blog/assets/img/8.7fd70360.png"></div><p></p></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/guiguzigang/blog/edit/master/docs/more/web-optimization.md" target="_blank" rel="noopener noreferrer">欢迎指正</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></div> <!----> </div> <!----></div></div>
    <script src="/blog/assets/js/2.d9c402ee.js" defer></script><script src="/blog/assets/js/app.4352e386.js" defer></script>
  </body>
</html>
